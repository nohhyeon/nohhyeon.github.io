---

title : "Spring 공부"
categories : study
tag : spring

---
Spring 공부

`findBySubjectLike` 메서드를 사용할 때 데이터 조회를 위한 조건이 되는 문자열로 `sbb%`와 같이 %를 적어 주어야 한다. %는 표기하는 위치에 따라 의미가 달라진다. 다음 표를 살펴보자.

|표기 예|표기 위치에 따른 의미|
|---|---|
|`sbb%`|'sbb'로 시작하는 문자열|
|`%sbb`|'sbb'로 끝나는 문자열|
|`%sbb%`|'sbb'를 포함하는 문자열|
-----`QuestionRepository`가 `findById` 메서드를 통해 `Question` 객체를 조회하고 나면 DB 세션이 끊어지기 때문이다.------

> DB 세션이란 스프링 부트 애플리케이션과 데이터베이스 간의 연결을 뜻한다.

그래서 그 이후에 실행되는 `q.getAnswerList()` 메서드(`Question` 객체로부터 answer 리스트를 구하는 메서드)는 세션이 종료되어 오류가 발생한다. `answerList`는 앞서 `q` 객체를 조회할 때가 아니라 `q.getAnswerList()` 메서드를 호출하는 시점에 가져오기 때문에 이와 같이 오류가 발생한 것이다.

> 이렇게 데이터를 필요한 시점에 가져오는 방식을 지연(Lazy) 방식이라고 한다. 이와 반대로 `q` 객체를 조회할 때 미리 `answer` 리스트를 모두 가져오는 방식은 즉시(Eager) 방식이라고 한다. `@OneToMany`, `@ManyToOne` 애너테이션의 옵션으로 `fetch=FetchType.LAZY` 또는 `fetch=FetchType.EAGER`처럼 가져오는 방식을 설정할 수 있는데, 따로 지정하지 않고 항상 기본값(디폴트값)을 사용한다.

사실 이 문제는 테스트 코드에서만 발생한다. 실제 서버에서 JPA 프로그램들을 실행할 때는 DB 세션이 종료되지 않아 이와 같은 오류가 발생하지 않는다.

!!!!테스트 코드를 수행할 때 이런 오류를 방지할 수 있는 가장 간단한 방법은 다음과 같이 `@Transactional` 애너테이션을 사용하는 것이다. `@Transactional` 애너테이션을 사용하면 메서드가 종료될 때까지 DB 세션이 유지된다.!!!!



